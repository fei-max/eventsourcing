---
import { getCollection } from "astro:content";
import { getEditionInfo } from "~utils";

const editions = await getCollection("editions");

if (!["yt", "tw"].includes(`${Astro.params.shortlink}`)) {
  return Astro.redirect("/");
}

for (const { id, data } of editions) {
  const info = getEditionInfo(id);
  if (info) {
    if (
      Astro.params.edition === `${info.num}` ||
      Astro.params.edition === info.base
    ) {
      if (Astro.params.shortlink === "tw") {
        return Astro.redirect(data.twitter);
      } else if (Astro.params.shortlink === "yt") {
        return Astro.redirect(data.youtube);
      }
    }
  }
}

return Astro.redirect("/");
---
