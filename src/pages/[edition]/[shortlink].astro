---
import type { VideoDocument, VideoFrontmatter } from "~types";
import { getEditionInfo, stripHtmlHeadings } from "~utils";

const editions = await Astro.glob<VideoFrontmatter>("../../editions/*.md");

if (!["yt", "tw"].includes(`${Astro.params.shortlink}`)) {
  return Astro.redirect("/");
}

for (const edition of editions) {
  const info = getEditionInfo(edition.file);
  if (info) {
    if (
      Astro.params.edition === `${info.num}` ||
      Astro.params.edition === info.base
    ) {
      if (Astro.params.shortlink === "tw") {
        return Astro.redirect(edition.frontmatter.twitter);
      } else if (Astro.params.shortlink === "yt") {
        return Astro.redirect(edition.frontmatter.youtube);
      }
    }
  }
}

return Astro.redirect("/");
---
