---
import { MarkdownLayoutProps } from 'astro';
import Card from '~/components/Card.astro';
import BaseLayout from './Layout.astro';
import { stripHtmlHeadings, toRandomNotUglyColor } from '~/utils';
import CtaLink from '~/components/CtaLink.astro';

type Props = MarkdownLayoutProps<{
  youtube: string;
  twitter: string;
}>;

const { headings, compiledContent, frontmatter } = Astro.props;

Astro.response.headers.set(
	'Cache-control',
	'public, max-age=31536000'
)

const title = headings.find(h => h.depth === 1)?.text ?? 'Whiteboard the Web'
---

<BaseLayout title={title} preconnectToYoutube={Boolean(frontmatter.youtube)}>
  <div>
    <h1>{title}</h1>
    <Card 
    title={title}
    showTitleAsHeading={false}
    htmlBody={stripHtmlHeadings(compiledContent())}
    twitter={frontmatter.twitter}
    youtube={frontmatter.youtube}
    />
    <CtaLink href="/">Hey, I learned something. Gimme more!</CtaLink>
  </div>
  <style define:vars={{ cardColor: toRandomNotUglyColor() }}>
  div {
    --color: var(--cardColor);
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }
  </style>
</BaseLayout>
